import unittest
import numpy as np

from src import utils


class TestUtils(unittest.TestCase):
    def test_get_obs_from_traj(self):
        trajectories = [
            [
                ([0.03073904, 0.00145001, -0.03088818, -0.03131252], 0, 1.0, [0.03076804, -0.19321569, -0.03151444, 0.25146705], False),
                ([0.03076804, -0.19321569, -0.03151444, 0.25146705], 0, 1.0, [0.02690373, -0.38787378, -0.02648509, 0.5340455], False),
                ([0.02690373, -0.38787378, -0.02648509, 0.5340455], 0, 1.0, [0.01914625, -0.58261345, -0.01580418, 0.81826685], False),
                ([0.01914625, -0.58261345, -0.01580418, 0.81826685], 0, 1.0, [7.49398544e-03, -7.77515543e-01, 5.61152656e-04, 1.10593724e+00], False),
                ([7.49398544e-03, -7.77515543e-01, 5.61152656e-04, 1.10593724e+00], 0, 1.0, [-0.00805633, -0.97264487, 0.0226799, 1.39879616], False),
            ],
            [
                ([0.02725216, -0.04481721, -0.04304738, 0.00151751], 0, 1.0, [0.02635582, -0.23929621, -0.04301703, 0.28031374], False),
                ([0.02635582, -0.23929621, -0.04301703, 0.28031374], 0, 1.0, [0.0215699, -0.43377897, -0.03741075, 0.55912491], False),
                ([0.0215699, -0.43377897, -0.03741075, 0.55912491], 0, 1.0, [0.01289432, -0.62835639, -0.02622826, 0.83979062], False),
                ([0.01289432, -0.62835639, -0.02622826, 0.83979062], 0, 1.0, [3.27187955e-04, -8.23110607e-01, -9.43244338e-03, 1.12411125e+00], False),
                ([3.27187955e-04, -8.23110607e-01, -9.43244338e-03, 1.12411125e+00], 0, 1.0, [-0.01613502, -1.01810765, 0.01304978, 1.4138207], False),
            ]
        ]
        print(np.dsplit(trajectories, 1))

        # expected_initial_shape = (2, 5, 4)
        # expected = [
        #         [0.03073904, 0.00145001, -0.03088818, -0.03131252],
        #         [0.03076804, -0.19321569, -0.03151444, 0.25146705],
        #         [0.02690373, -0.38787378, -0.02648509, 0.5340455],
        #         [0.01914625, -0.58261345, -0.01580418, 0.81826685],
        #         [7.49398544e-03, -7.77515543e-01, 5.61152656e-04, 1.10593724e+00],
        #         [0.02725216, -0.04481721, -0.04304738, 0.00151751],
        #         [0.02635582, -0.23929621, -0.04301703, 0.28031374],
        #         [0.0215699, -0.43377897, -0.03741075, 0.55912491],
        #         [0.01289432, -0.62835639, -0.02622826, 0.83979062],
        #         [3.27187955e-04, -8.23110607e-01, -9.43244338e-03, 1.12411125e+00],
        # ]
        # expected_reshaped = [
        #     [
        #         [0.03073904, 0.00145001, -0.03088818, -0.03131252],
        #         [0.03076804, -0.19321569, -0.03151444, 0.25146705],
        #         [0.02690373, -0.38787378, -0.02648509, 0.5340455],
        #         [0.01914625, -0.58261345, -0.01580418, 0.81826685],
        #         [7.49398544e-03, -7.77515543e-01, 5.61152656e-04, 1.10593724e+00],
        #     ],
        #     [
        #         [0.02725216, -0.04481721, -0.04304738, 0.00151751],
        #         [0.02635582, -0.23929621, -0.04301703, 0.28031374],
        #         [0.0215699, -0.43377897, -0.03741075, 0.55912491],
        #         [0.01289432, -0.62835639, -0.02622826, 0.83979062],
        #         [3.27187955e-04, -8.23110607e-01, -9.43244338e-03, 1.12411125e+00],
        #     ]
        # ]
        #
        # actual, actual_initial_shape = utils.get_obs_from_traj(trajectories)
        #
        # np.testing.assert_array_equal(actual_initial_shape, expected_initial_shape)
        # np.testing.assert_array_equal(actual, expected)
        #
        # actual_reshaped = np.array(actual).reshape(actual_initial_shape)
        # np.testing.assert_array_equal(actual_reshaped, expected_reshaped)
